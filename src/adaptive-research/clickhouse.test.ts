import { clickhouseClient } from "../lib/clickhouse-client.js";
import { period } from "./utils.js";

import dotenv from "dotenv";
dotenv.config();

const mock_events = [
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "你也会爱上一个人付出很多很多",
      transcriptid: "0e14fdd6-9cde-5e6d-9eb4-119b40eb183f",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=34.008248127792356",
    region: "BRU",
    id: "01K649PX32ZD15GENNAHK16DDZ",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933513314,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "content-viewed",
      email: "learnuidev@gmail.com",
    },
    href: "https://www.mandarino.io/convos",
    region: "VA",
    id: "01K646STTAYEA10JXAQX8FZB2K",
    latitude: 39.018,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930463562,
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    type: "custom",
    viewport: {
      width: 342,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "好多话想说给你听",
      transcriptid: "136fdbf7-f350-5a81-8bd9-90ec24065fb7",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
    region: "BRU",
    id: "01K649PS7C8TF1445ZFN3XQYRP",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933509356,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933500206,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649PG9EBCP76QPWKXHNDE35",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930461539,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SRV3DH44H6RDDD83DHSV",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936299587,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    href: "https://www.mandarino.io/convos/86edb296-6c8e-50ae-b3e5-642b4e2a6515",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    region: "ENG",
    id: "01K64CBY22V3YB5X0JVJE17C9Q",
    latitude: 51.3537,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936290335,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    href: "https://www.mandarino.io/",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    region: "ENG",
    id: "01K64CBMZQ944Z34RYJ55A4XDZ",
    latitude: 51.3537,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    extraData: {
      contentid: "86edb296-6c8e-50ae-b3e5-642b4e2a6515",
      eventName: "clicked-on-transcript",
      input: "再一起许七月的流星 八月温柔",
      transcriptid: "fa179987-aa98-51d0-9ac5-40180386a6ab",
    },
    href: "https://www.mandarino.io/convos/86edb296-6c8e-50ae-b3e5-642b4e2a6515?start=28.693056923706056",
    region: "ENG",
    id: "01K64CC92GWKNTQ1CQVTJ18ET8",
    latitude: 51.3537,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936310864,
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936295163,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    region: "ENG",
    id: "01K64CBSQVZKTNG2RPFV8YPA21",
    latitude: 51.3537,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    extraData: {
      contentid: "86edb296-6c8e-50ae-b3e5-642b4e2a6515",
      eventName: "clicked-on-transcript",
      input: "一起去兜风环游",
      transcriptid: "a70fa618-8ade-5bb0-a82b-64f1704712ae",
    },
    href: "https://www.mandarino.io/convos/86edb296-6c8e-50ae-b3e5-642b4e2a6515?start=5.197054982833862",
    region: "ENG",
    id: "01K64CC4RTSXVB1SN9ECPBQ36D",
    latitude: 51.3537,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936306458,
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933455515,
    identityId: "01K649N2YEFRFKAZ9FBK4T5K0X",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/goals",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N4MQMSB3XBVE0453FNQG",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933453399,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N2JPFNYQKE0K9GJQ3752",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "好多话想说给你听",
      transcriptid: "136fdbf7-f350-5a81-8bd9-90ec24065fb7",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=34.008248127792356",
    region: "BRU",
    id: "01K649PTVX248C0794PF6M8F23",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933511037,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933453734,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/performance",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N2X6K9FX7DZXY1XP0JWH",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930457962,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SNBAXDMKMGDZYQATPD8S",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933491017,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649P7A99Y8F77BDRV82MZSE",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "content-viewed",
      email: "learnuidev@gmail.com",
    },
    href: "https://www.mandarino.io/convos",
    region: "BRU",
    id: "01K649PFJQ10PQAV6A80HYCWR5",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933499479,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    extraData: {
      contentid: "86edb296-6c8e-50ae-b3e5-642b4e2a6515",
      eventName: "content-viewed",
      email: "learnuidev@gmail.com",
    },
    href: "https://www.mandarino.io/convos",
    region: "ENG",
    id: "01K64CBXFNF8RSGXG97C5B5B4B",
    latitude: 51.3537,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936298997,
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933497877,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649PE0N16FC7NY78NYPZEZF",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    extraData: {
      contentid: "86edb296-6c8e-50ae-b3e5-642b4e2a6515",
      eventName: "clicked-on-transcript",
      input: "九月雨下过后 天气为你变得融洽",
      transcriptid: "26c7e3da-43a5-52f0-ae53-705f3cfba283",
    },
    href: "https://www.mandarino.io/convos/86edb296-6c8e-50ae-b3e5-642b4e2a6515?start=86.01748308392334",
    region: "ENG",
    id: "01K64CCME5CKQAPGKXA3SWJGFC",
    latitude: 51.3537,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936322501,
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933453747,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/analytics",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N2XJH1KW7KMYH1M0F703",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930471882,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646T2YAE53XRZKMT6ZXCE8C",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936276259,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=144.34462909346007",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    region: "ENG",
    id: "01K64CB792Z66YXQJKAH420TPE",
    latitude: 51.3537,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    extraData: {
      contentid: "86edb296-6c8e-50ae-b3e5-642b4e2a6515",
      eventName: "clicked-on-transcript",
      input: "致远道而来的浪漫 以及你",
      transcriptid: "4df037c4-3aca-52c3-9e55-ed88873e582b",
    },
    href: "https://www.mandarino.io/convos/86edb296-6c8e-50ae-b3e5-642b4e2a6515?start=59.78333512016297",
    region: "ENG",
    id: "01K64CCCFYD2C7DRRTN2JH5DQW",
    latitude: 51.3537,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936314366,
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930461671,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SRZ6JEG9WR8HS1VMEAX4",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "你睡着手掌轻握",
      transcriptid: "151bd393-46d2-5f86-bd32-113850af6162",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=34.008248127792356",
    region: "ENG",
    id: "01K64CBF5GDDHYC4NWNCQBSS6Z",
    latitude: 51.3537,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936284336,
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "每天盼望从我掌心挣脱",
      transcriptid: "dcb5f91e-b231-5e00-9ad5-f21664c4e2c5",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=56.78274695613098",
    region: "BRU",
    id: "01K649Q0YXTRZWMPHQG0XRXR6D",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933517278,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    extraData: {
      contentid: "86edb296-6c8e-50ae-b3e5-642b4e2a6515",
      eventName: "clicked-on-transcript",
      input: "你是最美的晚霞",
      transcriptid: "e84fe82e-3d74-5515-a3c5-460c6fa1bbc9",
    },
    href: "https://www.mandarino.io/convos/86edb296-6c8e-50ae-b3e5-642b4e2a6515",
    region: "ENG",
    id: "01K64CC0RRP9Z3R39HCG23FJZ5",
    latitude: 51.3537,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936302361,
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930464182,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SVDP3GTCWTCQPAE6GBAH",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933455015,
    identityId: "01K649N2YEFRFKAZ9FBK4T5K0X",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/events",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N457GSMMQY74A53AK7Q2",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933454979,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/users",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N442J5VA5XWACDQV4NH2",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933454232,
    identityId: "01K649N2YEFRFKAZ9FBK4T5K0X",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/feature-flags",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N3CREKGFPX8THWCY1S46",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "82.26.162.42",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758936294982,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "GB",
    city: "Chatham",
    sessionId: "s938f0f1f-1741-443c-844d-0f0b4c390855",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: 0.5287,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/London",
    region: "ENG",
    id: "01K64CBSJ6HVVQ58K4EWBC7XXT",
    latitude: 51.3537,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933498042,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649PE5TZWWVW8CZ33NWNAJR",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
];

const clickhouseTest = async () => {
  return clickhouseClient;
};

// Manual Testing
clickhouseTest().then(async (resp) => {
  const {
    client,
    ingestDDBEvents,
    getFunnelData,
    getTotalPageVisitsByWebsiteId,
    listPagesByWebsiteId,
  } = resp;

  const exampleFunnel = {
    websiteId: "68d4c2a24b0000c1caa0dde9",
    name: "Content Usage Funnel",
    slug: "content-usage-funnel",
    steps: [
      {
        id: "_uQrghRE-pgLcFfkUgwPZ",
        name: "Clicks on Content",
        type: "goal",
        goalName: "content-viewed",
        goalCompletionType: "completed",
        _id: "68d736c1e5cddd8ba71b401b",
      },
      {
        id: "_uQrghRE-pgLcFfkUgwPZ",
        name: "Clicks on Transcript",
        type: "goal",
        goalName: "clicked-on-transcript",
        goalCompletionType: "completed",
        _id: "68d736c1e5cddd8ba71b401b",
      },
    ],
    isActive: true,
    createdAt: "2025-09-27T00:58:41.701Z",
    updatedAt: "2025-09-27T00:58:41.701Z",
    id: "68d736c1e5cddd8ba71b401a",
  };

  // const funnelData = await getFunnelData(
  //   client,
  //   exampleFunnel,
  //   "mando-prod",
  //   period.month
  // );

  // console.log("Funnel Data", funnelData);

  // const totalPageVisits = await getTotalPageVisitsByWebsiteId(
  //   client,
  //   "mando-prod",
  //   period.all
  // );

  // console.log("total-page-visits", totalPageVisits);

  // const totalRoutes = await listPagesByWebsiteId(client, "mando-prod");

  // console.log("total-routes", totalPageVisits);

  const hasUserEvents = await clickhouseClient.hasUserEvents(
    clickhouseClient,
    "mando-prod"
  );

  console.log("has-user-events", hasUserEvents);
});
