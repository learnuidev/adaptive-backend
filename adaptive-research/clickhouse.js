const { createClient } = require("@clickhouse/client");
const {
  mapDDBEvent,
  createEventTable,
  cleanEventTable,
  deleteEventTable,
  ingestDDBEvent,
  ingestDDBEvents,
  listEventsByWebsiteId,
  listEventByEmail,
  getTotalViewsByWebsiteId,
  getTotalPageVisitsByWebsiteId,
  getTotalVisitorsByGeo,
} = require("./events");
const { buildDateRange } = require("./utils");
const {
  createIdentityTable,
  ingestDDBIdentities,
  ingestDDBIdentity,
  mapDDBIdentity,
  cleanIdentityTable,
  deleteIdentityTable,
  listIdentitiesByWebsiteId,
  listIdentitiesByEmail,
} = require("./identity");
require("dotenv").config();

const mock_events = [
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "你也会爱上一个人付出很多很多",
      transcriptid: "0e14fdd6-9cde-5e6d-9eb4-119b40eb183f",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=34.008248127792356",
    region: "BRU",
    id: "01K649PX32ZD15GENNAHK16DDZ",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933513314,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "content-viewed",
      email: "learnuidev@gmail.com",
    },
    href: "https://www.mandarino.io/convos",
    region: "VA",
    id: "01K646STTAYEA10JXAQX8FZB2K",
    latitude: 39.018,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930463562,
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    type: "custom",
    viewport: {
      width: 342,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "好多话想说给你听",
      transcriptid: "136fdbf7-f350-5a81-8bd9-90ec24065fb7",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
    region: "BRU",
    id: "01K649PS7C8TF1445ZFN3XQYRP",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933509356,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933500206,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649PG9EBCP76QPWKXHNDE35",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930461539,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SRV3DH44H6RDDD83DHSV",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933455515,
    identityId: "01K649N2YEFRFKAZ9FBK4T5K0X",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/goals",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N4MQMSB3XBVE0453FNQG",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933453399,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N2JPFNYQKE0K9GJQ3752",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "好多话想说给你听",
      transcriptid: "136fdbf7-f350-5a81-8bd9-90ec24065fb7",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=34.008248127792356",
    region: "BRU",
    id: "01K649PTVX248C0794PF6M8F23",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933511037,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933453734,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/performance",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N2X6K9FX7DZXY1XP0JWH",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930457962,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SNBAXDMKMGDZYQATPD8S",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933491017,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649P7A99Y8F77BDRV82MZSE",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "content-viewed",
      email: "learnuidev@gmail.com",
    },
    href: "https://www.mandarino.io/convos",
    region: "BRU",
    id: "01K649PFJQ10PQAV6A80HYCWR5",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933499479,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933497877,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649PE0N16FC7NY78NYPZEZF",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933453747,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/analytics",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N2XJH1KW7KMYH1M0F703",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930471882,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646T2YAE53XRZKMT6ZXCE8C",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930461671,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SRZ6JEG9WR8HS1VMEAX4",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    extraData: {
      contentid: "b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
      eventName: "clicked-on-transcript",
      input: "每天盼望从我掌心挣脱",
      transcriptid: "dcb5f91e-b231-5e00-9ad5-f21664c4e2c5",
    },
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d?start=56.78274695613098",
    region: "BRU",
    id: "01K649Q0YXTRZWMPHQG0XRXR6D",
    latitude: 50.8847,
    domain: "www.mandarino.io",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933517278,
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    type: "custom",
    viewport: {
      width: 1374,
      height: 859,
    },
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758930464182,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "sd54b5ada-f54b-46ba-89c9-7e820820ae65",
    href: "https://www.mandarino.io/convos/b3f8880b-def5-5ff7-97a0-cbab2b07b41d",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K646SVDP3GTCWTCQPAE6GBAH",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 342,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933455015,
    identityId: "01K649N2YEFRFKAZ9FBK4T5K0X",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/events",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N457GSMMQY74A53AK7Q2",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933454979,
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/users",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N442J5VA5XWACDQV4NH2",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "45.144.115.137",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aecd7b27-cf35-49ac-806b-29f035917dd0",
    createdAt: 1758933454232,
    identityId: "01K649N2YEFRFKAZ9FBK4T5K0X",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "US",
    city: "Ashburn",
    sessionId: "scb614cb2-a487-41d4-8c94-bce50f862bab",
    href: "https://www.adaptive.fyi/feature-flags",
    browser_name: "Chrome",
    longitude: -77.539,
    websiteId: "adaptive",
    device_vendor: "Apple",
    timezone: "America/New_York",
    region: "VA",
    id: "01K649N3CREKGFPX8THWCY1S46",
    latitude: 39.018,
    type: "pageview",
    viewport: {
      width: 1512,
      height: 945,
    },
    domain: "www.adaptive.fyi",
  },
  {
    os_version: "10.15.7",
    ipAddress: "146.70.123.46",
    os_name: "macOS",
    device_model: "Macintosh",
    visitorId: "aa0760f4-ff9f-47ea-a2cf-feb01b274f20",
    createdAt: 1758933498042,
    identityId: "01K646SNFB4JZSMBMR3QSJWVF6",
    browser_version: "140.0.0.0",
    email: "learnuidev@gmail.com",
    country: "BE",
    city: "Brussels",
    sessionId: "sa8fcde73-7cd5-4641-aa93-e40f9c07bce2",
    href: "https://www.mandarino.io/convos",
    browser_name: "Chrome",
    longitude: 4.5049,
    websiteId: "mando-prod",
    device_vendor: "Apple",
    timezone: "Europe/Brussels",
    region: "BRU",
    id: "01K649PE5TZWWVW8CZ33NWNAJR",
    latitude: 50.8847,
    type: "pageview",
    viewport: {
      width: 1374,
      height: 859,
    },
    domain: "www.mandarino.io",
  },
];

const clickhouse = async (params) => {
  const client = createClient(params);

  //   run migrations
  console.log("client generated");

  // Migrations
  await createIdentityTable(client);
  await createEventTable(client);

  return {
    client,
    // Identity
    createIdentityTable,
    ingestDDBIdentities,
    ingestDDBIdentity,
    mapDDBIdentity,
    cleanIdentityTable,
    deleteIdentityTable,
    listIdentitiesByWebsiteId,
    listIdentitiesByEmail,
    // Event
    createEventTable,
    ingestDDBEvents,
    ingestDDBEvent,
    mapDDBEvent,
    cleanEventTable,
    deleteEventTable,
    listEventsByWebsiteId,
    listEventByEmail,
    // Query Functions
    getTotalViewsByWebsiteId,
    getTotalPageVisitsByWebsiteId,
    getTotalVisitorsByGeo,
  };
};

// testing

const params = {
  url: process.env.CLICKHOUSE_URL,
  username: process.env.CLICKHOUSE_USERNAME,
  password: process.env.CLICKHOUSE_PASSWORD,
};

// Manual Testing
clickhouse(params).then(async (resp) => {
  const { client } = resp;
  // await ingestDDBIdentities(client, mockIdentities);
  // await cleanIdentityTable(client);
  // const identities = await listIdentitiesByWebsiteId(client, "mando-prod");
  // console.log("identities", identities);
  // const identities = await listIdentitiesByEmail(client, "learnuidev@gmail.com");
  // console.log("identities", identities);
  await ingestDDBEvents(client, mock_events);
  // await cleanEventTable(client);
  const events = await listEventsByWebsiteId(client, "mando-prod");
  console.log("events", events);
  // const events = await listEventByEmail(client, "learnuidev@gmail.com");
  // console.log("events", events);
  // console.log("client", client);
  // await ingestDDBEvents(client, mockEvents);
  // const learnuiEvents = await listEventByEmail(client, "learnuidev@gmail.com");
  // console.log("learnuiEvents", learnuiEvents);
  // const totalViews = await getTotalViewsByWebsiteId(
  //   client,
  //   "mando-prod",
  //   "year"
  // );
  //   console.log("totalViews", totalViews);
  // const totalPageVisits = await getTotalPageVisitsByWebsiteId(
  //   client,
  //   "mando-prod",
  //   "month"
  // );
  // console.log("total page visits", totalPageVisits);
  // Errors out
  // const geoVisits = await getTotalVisitorsByGeo(client, "mando-prod", "month");
  // console.log("geoVisits", geoVisits);
  // await deleteIdentityTable(client);
  // await deleteEventTable(client);
});
